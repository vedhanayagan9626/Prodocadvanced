<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Management System</title>
    <!-- FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts (Roboto) -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap">
    <link rel="stylesheet" href="static/css/homestyle.css">
    <link rel="stylesheet" href="static/css/notifications.css">
    <!-- bootstrap css -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- In your HTML head section -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

</head>
<body>
    
    <header class="main-header">
    <div class="header-container">
        <!-- Left side - Company logo and name -->
        <div class="header-left">
            <img src="static/logos/invoice1.png" alt="Company Logo" class="company-logo">
            <span class="company-name">ProDoc</span>
        </div>
        
        <!-- Middle - Page title (will be updated dynamically) -->
        <div class="header-center">
            <h1 class="page-title">All Documents</h1>
        </div>
        
        <!-- Right side - User controls -->
        <div class="header-right">
            <span class="org-name">CTI Corporation</span>
            <div class="user-dropdown" id="user-dropdown">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>
</header>

<div class="toast-container position-fixed top-0 end-0 p-3">
  <div id="toast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">Logging out...</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>

<!-- Logout Confirmation Modal -->
<div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="logoutModalLabel">Confirm Logout</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to log out?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmLogoutBtn">Logout</button>
      </div>
    </div>
  </div>
</div>
<!-- Main Content Wrapper -->
<div class="content-wrapper">
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="sidebar-header">
            <img src="static/logos/invoice1.png" alt="Logo" class="logo">
            <h2>DocManage</h2>
        </div>
        <ul class="sidebar-menu">
            <li class="active" onclick="showContent('all-documents', event)">
                <i class="fas fa-file-lines" style="color:#4285f4"></i> All Documents
            </li>
            <li onclick="showContent('completed-list', event)">
                <i class="fas fa-check-circle" style="color:#34a853"></i> Completed Bills
            </li>
            <li onclick="showContent('choose-template', event)">
                <i class="fas fa-clipboard-list" style="color:#43a047"></i> Choose Template
            </li>
        </ul>
    </div>
    <!-- Main Content Area -->
    <div class="main-content">
        <!-- All Documents Content (default view) -->
        <div id="all-documents" class="content-section">
            <div class="card">
                <div class="content-header">
                    <h2>All Documents</h2>
                    <button class="upload-btn" onclick="document.getElementById('file-upload').click()">
                        <i class="fas fa-cloud-upload-alt"></i> Upload File
                    </button>
                    <input type="file" id="file-upload" multiple>
                </div>
                <div class="filter-bar">
                    <i class="fas fa-filter"></i><span>Filter By:</span>
                    <select class="filter-select">
                        <option selected>All Files</option>
                        <option>PDF</option>
                        <option>Images</option>
                        <option>Documents</option>
                    </select>
                    <select class="filter-select">
                        <option selected>All Dates</option>
                        <option>Today</option>
                        <option>Last 7 Days</option>
                        <option>This Month</option>
                    </select>
                    <button id="delete-btn" class="delete-btn" style="display:none;">
                        <i class="fas fa-trash-alt"></i> Delete Selected
                    </button>
                </div>
                <table class="documents-table">
                    <thead>
                        <tr>
                            <th width="40px">
                                <input type="checkbox" id="select-all-checkbox" onchange="window.toggleAllFiles(this)">
                            </th>
                            <th>File Name</th>
                            <th>Size</th>
                            <th>Uploaded On</th>
                            <th width="180px">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="documents-list">
                        <!-- Files populated via JS -->
                    </tbody>
                </table>
            </div>
        </div>
                <!-- Completed Bills Content -->
        <div id="completed-list" class="content-section" style="display:none;">
            <div class="card">
                <div class="content-header">
                    <h2>Completed Bills</h2>
                    <div style="display: inline-flex;">
                        <button class="upload-btn" onclick="document.getElementById('file-upload').click()">
                            <i class="fas fa-cloud-upload-alt"></i> Upload Bill
                        </button>
                        <button class="upload-btn" style="margin-left: 10px; background-color: #34a853;">
                            <i class="fas fa-plus"></i> New
                        </button>
                    </div>
                </div>
                
                <table class="documents-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Invoice No.</th>
                            <th>Seller</th>
                            <th>Buyer</th>
                            <th>Items</th>
                            <th>Tax Amount</th>
                            <th>Total</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="completed-invoices-body">
                        <!-- Data will be populated by JavaScript -->
                    </tbody>
                </table>
                <div class="pagination-controls">
                    <button id="prev-page" disabled>Previous</button>
                    <span id="page-info">Page 1 of 1</span>
                    <button id="next-page" disabled>Next</button>
                </div>
            </div>
        </div>
        
        <!-- Choose Template Content -->
        <div id="choose-template" class="content-section" style="display:none;">
            <div class="card">
                <div class="content-header">
                    <h2>Choose Template</h2>
                    <div class="template-controls">
                        <select id="template-filter" class="filter-select">
                            <option value="all">All Categories</option>
                            <option value="Business">Business</option>
                            <option value="Minimal">Minimal</option>
                        </select>
                        <button class="upload-btn" id="use-template-btn">
                            <i class="fas fa-check"></i> Use Selected Template
                        </button>
                    </div>
                </div>
                <div class="template-grid-container">
                    <div class="template-grid" id="templateGrid">
                        <!-- Templates will be loaded here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="main-footer">
    <div class="footer-container">
        <div class="footer-left">
            <span>&copy; 2023 DocManage Pro. All rights reserved.</span>
        </div>
        <div class="footer-right">
            <a href="#">Terms of Service</a>
            <a href="#">Privacy Policy</a>
            <a href="#">Contact Us</a>
        </div>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
        // Check authentication status when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            const token = localStorage.getItem('authToken');
            
            if (!token) {
                // Redirect to login if no token found
                window.location.href = '/login';
                return;
            }

            try {
                // Verify token and get user data
                const response = await fetch('/api/v1/auth/verify-token', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Invalid token');
                }
                
                const userData = await response.json();
                updateUserUI(userData);
                
            } catch (error) {
                console.error('Authentication error:', error);
                localStorage.removeItem('authToken');
                window.location.href = '/login';
            }
        });

        function updateUserUI(userData) {
            const dropdown = document.getElementById('user-dropdown');
            
            // Default values (can be updated with real user data later)
            const username = userData.username || 'Shaam Vedha';
            const email = userData.email || 'shaamvedha.ct@gmail.com';
            const avatar = 'static/userpng/vedha.jpeg'; // Default image
            
            dropdown.innerHTML = `
                <button class="user-btn">
                    <img src="${avatar}" alt="User" class="user-avatar">
                    <i class="fas fa-caret-down"></i>
                </button>
                <div class="dropdown-content">
                    <div class="user-info">
                        <img src="${avatar}" alt="User" class="dropdown-avatar">
                        <div>
                            <strong>${username}</strong>
                            <small>${email}</small>
                        </div>
                    </div>
                    <a href="#"><i class="fas fa-user"></i> Profile</a>
                    <a href="#"><i class="fas fa-cog"></i> Settings</a>
                    <a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </div>
            `;
            
            // Add logout functionality
            // Show logout modal when logout button is clicked
            document.getElementById('logout-btn')?.addEventListener('click', function(e) {
                e.preventDefault();
                const logoutModal = new bootstrap.Modal(document.getElementById('logoutModal'));
                logoutModal.show();
            });

            // Handle logout confirmation
            document.getElementById('confirmLogoutBtn')?.addEventListener('click', function() {
                localStorage.removeItem('authToken');

                // Hide modal
                const logoutModalEl = document.getElementById('logoutModal');
                const modalInstance = bootstrap.Modal.getInstance(logoutModalEl);
                modalInstance.hide();

                // Show toast
                showToast("You have been logged out", true, 3000);

                // Redirect after toast delay
                setTimeout(() => {
                    window.location.href = '/login';
                }, 1500);
            });

            // Toast function with duration support
            function showToast(message, isSuccess = true, duration = 1500) {
                const toastEl = $('#toast');
                toastEl.removeClass('text-bg-success text-bg-danger')
                    .addClass(isSuccess ? 'text-bg-success' : 'text-bg-danger')
                    .find('.toast-body').text(message);

                const toast = new bootstrap.Toast(toastEl[0], {
                    delay: duration,
                    autohide: true
                });
                toast.show();
            }
        }
    </script>
    <!-- JS (order matters; FontAwesome must load before) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- In your HTML head section -->
    <script type="module" src="/static/js/notifications.js"></script>
    <script type="module" src="/static/js/home.js"></script>
    <!-- <script type="module" src="/static/js/completed_list.js"></script> -->
    <script type="module" src="/static/js/invoice_template.js"></script>
    <script type="module" src="/static/js/completed_list.js"></script>
</body>
</html>
